


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>Manual Setup - SORMAS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4dd2dd8d.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installing-a-sormas-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="SORMAS" class="md-header-nav__button md-logo" aria-label="SORMAS">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            SORMAS
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Manual Setup
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/hzi-braunschweig/SORMAS-Project/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hzi-braunschweig/SORMAS-Project
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../DEVELOPMENT_ENVIRONMENT/" class="md-tabs__link md-tabs__link--active">
          For Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../SERVER_CUSTOMIZATION/" class="md-tabs__link">
          For Admins
        </a>
      
    </li>
  

      
        
  <li class="md-tabs__item">
    <a href="https://sormas.org" class="md-tabs__link">
      Offical Website
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SORMAS" class="md-nav__button md-logo" aria-label="SORMAS">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    SORMAS
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/hzi-braunschweig/SORMAS-Project/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hzi-braunschweig/SORMAS-Project
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    
    <label class="md-nav__link" for="nav-1">
      For Developers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="For Developers" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        For Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../DEVELOPMENT_ENVIRONMENT/" title="Automated Setup" class="md-nav__link">
      Automated Setup
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Manual Setup
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Manual Setup" class="md-nav__link md-nav__link--active">
      Manual Setup
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    Content
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    Related
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#java-11" class="md-nav__link">
    Java 11
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-database" class="md-nav__link">
    Postgres Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sormas-server" class="md-nav__link">
    SORMAS Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-server-setup" class="md-nav__link">
    Web Server Setup
  </a>
  
    <nav class="md-nav" aria-label="Web Server Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apache-web-server" class="md-nav__link">
    Apache Web Server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ADDING_LICENSE/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      For Admins
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="For Admins" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        For Admins
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SERVER_CUSTOMIZATION/" title="Customizing a SORMAS Server" class="md-nav__link">
      Customizing a SORMAS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SERVER_UPDATE/" title="Updating a SORMAS Server" class="md-nav__link">
      Updating a SORMAS Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SOP_DISEASES/" title="SOP for Adding New Diseases to SORMAS" class="md-nav__link">
      SOP for Adding New Diseases to SORMAS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://sormas.org" title="Offical Website" class="md-nav__link">
      Offical Website
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    Content
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related" class="md-nav__link">
    Related
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#java-11" class="md-nav__link">
    Java 11
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-database" class="md-nav__link">
    Postgres Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sormas-server" class="md-nav__link">
    SORMAS Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-server-setup" class="md-nav__link">
    Web Server Setup
  </a>
  
    <nav class="md-nav" aria-label="Web Server Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apache-web-server" class="md-nav__link">
    Apache Web Server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/hzi-braunschweig/SORMAS-Project/edit/master/docs/SERVER_SETUP.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="installing-a-sormas-server">Installing a SORMAS Server</h1>
<p><strong>Note: This guide explains how to set up a SORMAS server on Linux and Windows systems, the latter only being intended for usage on development systems. Please also note that certain parts of the setup script will not be executed on Windows.</strong></p>
<h2 id="content">Content</h2>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#java-11">Java 11</a></li>
<li><a href="#postgres-database">Postgres Database</a></li>
<li><a href="#sormas-server">SORMAS Server</a></li>
<li><a href="#web-server-setup">Web Server Setup</a></li>
<li><a href="#apache-web-server">Apache Web Server</a></li>
<li><a href="#firewall">Firewall</a></li>
<li><a href="#postfix-mail-server">Postfix Mail Server</a></li>
<li><a href="#testing-the-server-setup">Testing the Server Setup</a></li>
<li><a href="#r-software-environment">R Software Environment</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ul>
<h2 id="related">Related</h2>
<ul>
<li><a href="../DEMO_APP/">Creating an App for a Demo Server</a></li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="java-11">Java 11</h3>
<ul>
<li>Download and install the Java 11 <strong>JDK</strong> (not JRE) for your operating system. We suggest to use Zulu OpenJDK: https://www.azul.com/downloads/zulu/</li>
<li><strong>Linux</strong>: https://docs.azul.com/zulu/zuludocs/#ZuluUserGuide/PrepareZuluPlatform/AttachAPTRepositoryUbuntuOrDebianSys.htm<pre><code>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 0xB1998361219BD9C9
sudo apt-add-repository 'deb https://repos.azul.com/zulu/deb/ stable main'
sudo apt-get update
sudo apt-get install zulu11
</code></pre>
<ul>
<li><strong>Windows</strong>: For testing and development environments we suggest to download and run the installer of the Java 11 <strong>JDK</strong> for 32 or 64 bit client systems (depending on your system).</li>
<li>You can check your Java version from the shell/command line using: <code>java -version</code></li>
</ul>
</li>
</ul>
<h3 id="postgres-database">Postgres Database</h3>
<ul>
<li>Install PostgreSQL (currently 9.5, 9.6 or 10) on your system (manuals for all OS can be found here: https://www.postgresql.org/download)</li>
<li>Set <strong>max_connections = 288</strong> and <strong>max_prepared_transactions = 256</strong> (at least, sum of all connection pools) in <code>postgresql.conf</code> (e.g. <code>/etc/postgresql/10.0/main/postgresql.conf</code>; <code>C:/Program Files/PostgreSQL/10.0/data</code>) - make sure the property is uncommented</li>
<li>Install the "temporal tables" extension for Postgres (https://github.com/arkhipov/temporal_tables)<ul>
<li><strong>Windows</strong>: Download the latest version for your Postgres version: https://github.com/arkhipov/temporal_tables/releases/latest, then copy the DLL from the project into the PostgreSQL's lib directory and the .sql and .control files into the directory share\extension.   </li>
<li><strong>Linux</strong> (see https://github.com/arkhipov/temporal_tables#installation):<ul>
<li><code>sudo apt-get install libpq-dev</code></li>
<li><code>sudo apt-get install postgresql-server-dev-all</code></li>
<li><code>sudo apt install pgxnclient</code></li>
<li>Check for GCC: <code>gcc --version</code> and install if missing</li>
<li><code>sudo pgxn install temporal_tables</code></li>
<li>The packages can be removed afterward</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="sormas-server">SORMAS Server</h2>
<ul>
<li>Get the latest SORMAS build by downloading the ZIP archive from the latest release on GitHub: https://github.com/hzi-braunschweig/SORMAS-Open/releases/latest </li>
<li><strong>Linux</strong>:</li>
<li>Unzip the archive, copy/upload its contents to <strong>/root/deploy/sormas/$(date +%F)</strong> and make the setup script executable.<pre><code>cd /root/deploy/sormas
SORMAS_VERSION=1.y.z
wget https://github.com/hzi-braunschweig/SORMAS-Project/releases/download/v${SORMAS_VERSION}/sormas_${SORMAS_VERSION}.zip
unzip sormas_${SORMAS_VERSION}.zip
mv deploy/ $(date +%F)
rm sormas_${SORMAS_VERSION}.zip
chmod +x $(date +%F)/server-setup.sh
</code></pre>
<ul>
<li><strong>Windows</strong>:</li>
<li>Download &amp; install Git for Windows. This will provide a bash emulation that you can use to run the setup script: https://gitforwindows.org/</li>
<li>Unzip the ZIP archive (e.g. into you download directory)</li>
<li>Open Git Bash and navigate to the setup sub-directory</li>
<li>Optional: Open <code>server-setup.sh</code> in a text editor to customize the install paths, database access and ports for the server. The default ports are 6080 (HTTP), 6081 (HTTPS) and 6048 (admin). <strong>Important:</strong> Do not change the name of the database user. The pre-defined name is used in the statements executed in the database.</li>
<li>Set up the database and a Payara domain for SORMAS by executing the setup script: <code>sudo -s ./server-setup.sh</code> Press enter whenever asked for it</li>
<li><strong>IMPORTANT</strong>: Make sure the script executed successfully. If anything goes wrong you need to fix the problem (or ask for help), then delete the created domain directory and re-execute the script.</li>
<li><strong>IMPORTANT</strong>: Adjust the SORMAS configuration for your country in /opt/domains/sormas/sormas.properties</li>
<li>Adjust the logging configuration in <code>/opt/domains/sormas/config/logback.xml</code> based on your needs (e.g. configure and activate email appender)</li>
<li>Linux: <a href="../SERVER_UPDATE/">Update the SORMAS domain</a></li>
</ul>
</li>
</ul>
<h2 id="web-server-setup">Web Server Setup</h2>
<h3 id="apache-web-server">Apache Web Server</h3>
<p><strong>Note: This is not necessary for development systems.</strong> When you are using SORMAS in a production environment you should use a http server like Apache 2 instead of putting the Payara server in the first line.
Here are some things that you should do to configure the Apache server as a proxy:</p>
<ul>
<li>
<p>Activate all needed modules:</p>
<pre><code>a2enmod ssl
a2enmod rewrite
a2enmod proxy
a2enmod proxy_http
a2enmod headers
</code></pre>
<ul>
<li>Create a new site /etc/apache2/sites-available/your.sormas.server.url.conf (e.g. sormas.org.conf)</li>
<li>
<p>Force SSL secured connections: redirect from http to https:</p>
<p><VirtualHost *:80>
    ServerName your.sormas.server.url
    RewriteEngine On
    RewriteCond %{HTTPS} !=on
    RewriteRule ^/(.*) https://your.sormas.server.url/$1 [R,L]
</VirtualHost>
<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName your.sormas.server.url
    ...
</VirtualHost>
</IfModule>
* Configure logging:</p>
<p>ErrorLog /var/log/apache2/error.log
LogLevel warn
LogFormat "%h %l %u %t \"%r\" %&gt;s %b <em>%D</em> \"%{User}i\"  \"%{Connection}i\"  \"%{Referer}i\" \"%{User-agent}i\"" combined_ext
CustomLog /var/log/apache2/access.log combined_ext
* SSL key config:</p>
<p>SSLEngine on
SSLCertificateFile    /etc/ssl/certs/your.sormas.server.url.crt
SSLCertificateKeyFile /etc/ssl/private/your.sormas.server.url.key
SSLCertificateChainFile /etc/ssl/certs/your.sormas.server.url.ca-bundle</p>
<h1 id="disable-weak-ciphers-and-old-tlsssl">disable weak ciphers and old TLS/SSL</h1>
<p>SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE$
SSLHonorCipherOrder off   <br />
* Add a proxy pass to the local port:</p>
<p>ProxyRequests Off
ProxyPass /sormas-ui http://localhost:6080/sormas-ui
ProxyPassReverse /sormas-ui http://localhost:6080/sormas-ui
ProxyPass /sormas-rest http://localhost:6080/sormas-rest
ProxyPassReverse /sormas-rest http://localhost:6080/sormas-rest
* Configure security settings:</p>
<p>Header always set X-Content-Type-Options "nosniff"
Header always set X-Xss-Protection "1; mode=block"</p>
<h1 id="disable-caching">Disable Caching</h1>
<p>Header always set Cache-Control "no-cache, no-store, must-revalidate, private"
Header always set Pragma "no-cache"</p>
<p>Header always set Content-Security-Policy \
    "default-src 'none'; \
    object-src 'self'; \
    script-src 'self' 'unsafe-inline' 'unsafe-eval'; \
    connect-src https://fonts.googleapis.com https://fonts.gstatic.com 'self'; \
    img-src *; \
    style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; \
    font-src https://fonts.gstatic.com 'self'; \
    frame-src 'self'; \
    worker-src 'self'; \
    manifest-src 'self'; \
    frame-ancestors 'self'      </p>
<h1 id="the-content-type-header-was-either-missing-or-empty">The Content-Type header was either missing or empty.</h1>
<h1 id="ensure-each-page-is-setting-the-specific-and-appropriate-content-type-value-for-the-content-being-delivered">Ensure each page is setting the specific and appropriate content-type value for the content being delivered.</h1>
<p>AddType application/vnd.ms-fontobject    .eot
AddType application/x-font-opentype      .otf
AddType image/svg+xml                    .svg
AddType application/x-font-ttf           .ttf
AddType application/font-woff            .woff
* Activate output compression (very important!): </p>
<p><IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain text/html text/xml
        AddOutputFilterByType DEFLATE text/css text/javascript
        AddOutputFilterByType DEFLATE application/json
        AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
        AddOutputFilterByType DEFLATE application/javascript application/x-javascript
        DeflateCompressionLevel 1
</IfModule></code></p>
</li>
</ul>
</li>
<li>
<p>Provide the android apk:</p>
<pre><code>Options -Indexes
AliasMatch "/downloads/sormas-(.*)" "/var/www/sormas/downloads/sormas-$1"
</code></pre>
</li>
<li>
<p>For the Apache 2 security configuration we suggest the following settings (<code>/etc/apache2/conf-available/security.conf</code>):</p>
<pre><code>ServerTokens Prod
ServerSignature Off
TraceEnable Off

Header always set Strict-Transport-Security "max-age=15768000; includeSubDomains; preload"
Header unset X-Frame-Options
Header always set X-Frame-Options SAMEORIGIN
Header unset Referrer-Policy
Header always set Referrer-Policy "same-origin"
Header edit Set-Cookie "(?i)^((?:(?!;\s?HttpOnly).)+)$" "$1;HttpOnly"
Header edit Set-Cookie "(?i)^((?:(?!;\s?Secure).)+)$" "$1;Secure"

Header unset X-Powered-By
Header unset Server
</code></pre>
</li>
<li>
<p>In case you need to update the site config while the server is running, use the following command to publish the changes without the need for a reload:</p>
<pre><code>apache2ctl graceful
</code></pre>
</li>
</ul>
<h3 id="firewall">Firewall</h3>
<ul>
<li>The server should only publish the ports that are needed. For SORMAS this is port 80 (HTTP) and 443 (HTTPS). In addition you will need the SSH port to access the server for admin purposes.</li>
<li>We suggest to use UFW (Uncomplicated Firewall) which provides a simple interface to iptables:<pre><code>sudo apt-get install ufw
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw enable
</code></pre>
</li>
</ul>
<h3 id="postfix-mail-server">Postfix Mail Server</h3>
<ul>
<li>
<p>Install postfix and mailutils:</p>
<pre><code>apt install aptitude
aptitude install postfix
-&gt; choose "satelite system"
apt install mailutils
</code></pre>
</li>
<li>
<p>Configure your system:</p>
<pre><code>nano /etc/aliases
-&gt; add "root: enter-your@support-email-here.com"
nano /opt/domains/sormas/config/logback.xml
-&gt; make sure "EMAIL_ERROR" appender is active and sends out to your email address
</code></pre>
</li>
</ul>
<h3 id="testing-the-server-setup">Testing the Server Setup</h3>
<p>Use SSL Labs to test your server security config: https://www.ssllabs.com/ssltest</p>
<h2 id="r-software-environment">R Software Environment</h2>
<p>In order to enable disease network diagrams in the contact dashboard, R and several extension packages are required.
Then the Rscript executable has to be configured in the <code>sormas.properties</code> file.
This can be conveniently accomplished by executing the R setup script from the SORMAS ZIP archive (see <a href="#sormas-server">SORMAS Server</a>):</p>
<ul>
<li>If the SORMAS installation has been customized, <code>r-setup.sh</code> the install paths may have to be adjusted accordingly with a text editor.</li>
<li>
<p>Execute R setup script:</p>
<p>chmod +x r-setup.sh
./r-setup.sh</p>
</li>
<li>
<p>Follow the instructions of the script.</p>
</li>
</ul>
<h2 id="sormas-to-sormas-certificate-setup">SORMAS to SORMAS Certificate Setup</h2>
<p>To be able to communicate with other SORMAS instances, there are some additional steps which need to be taken, in order to set
up the certificate and the truststore. Please see the <a href="../GUIDE_SORMAS2SORMAS_CERTIFICATE/">related guide</a> for detailed instructions regarding
SORMAS to SORMAS setup.
<br/></p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="problem-login-fails">Problem: Login fails</h3>
<p>Check that the users table does have a corresponding entry. If not, the database initialization that is done when deploying sormas-ear.ear probably had an error.</p>
<h3 id="problem-server-is-out-of-memory">Problem: Server is out of memory</h3>
<p>Old servers were set up with a memory size of less than 2048MB. You can change this using the following commands:</p>
<pre><code>/opt/payara-172/glassfish/bin/asadmin --port 6048 delete-jvm-options -Xmx512m
/opt/payara-172/glassfish/bin/asadmin --port 6048 delete-jvm-options -Xmx1024m
/opt/payara-172/glassfish/bin/asadmin --port 6048 create-jvm-options -Xmx2048m
</code></pre>
<p>Alternative: You can edit the settings directly in the domain.xml in the config directory of the SORMAS domain. Just search for <code>Xmx</code> - there should be two entries that need to be changed.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../DEVELOPMENT_ENVIRONMENT/" title="Automated Setup" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Automated Setup
              </div>
            </div>
          </a>
        
        
          <a href="../ADDING_LICENSE/" title="License" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                License
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/hzi-braunschweig/SORMAS-Project" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>